fn test_simple_propagate() -> i32 {
    let mut err = 0;

    let inputs = @|i:i32| {1.0 as f32};
    let weights = @|i:i32, j:i32| {j as f32 + (i as f32 / 10.0)};
    let biases = @|i:i32| {0.0 as f32};

    // compare propagated values to standard matrix multiplication
    let outputs = neural_propagate(inputs, 3, weights, biases);
    
    let mat = make_mat3x3(
        make_vec3(weights(0,0), weights(1,0), weights(2,0)),
        make_vec3(weights(0,1), weights(1,1), weights(2,1)),
        make_vec3(weights(0,2), weights(1,2), weights(2,2)),
    );
    let in_vec = make_vec3(inputs(0), inputs(1), inputs(2));
    let out_vec = mat3x3_mul(mat, in_vec);

    if (!eq_f32(out_vec.x, outputs(0))) {err += 1;}
    if (!eq_f32(out_vec.y, outputs(1))) {err += 1;}
    if (!eq_f32(out_vec.z, outputs(2))) {err += 1;}

    err
}

fn test_eval() -> i32 {
    let mut err = 0;

    let values : [f32 * 675] = [-1.8908807039260864, -1.7179336547851562, -1.490980625152588, -0.049853432923555374, -0.026077520102262497, 0.9764702916145325, -3.4514806270599365, -2.1438844203948975, -0.023013710975646973, -2.87538480758667, -0.029940295964479446, -1.8897645473480225, -0.4632401168346405, -0.02317073568701744, -1.6734185218811035, -0.8478108048439026, 0.6858924031257629, 0.944277286529541, -0.4867245554924011, 0.6686785817146301, -0.23793023824691772, -0.005296170711517334, -0.039840828627347946, -0.046546030789613724, -0.042834509164094925, 0.01930936798453331, -0.022417116910219193, 0.0004227980971336365, -0.0333934910595417, -0.04796265438199043, 0.009873531758785248, -0.040022123605012894, 0.04647587612271309, -0.048044659197330475, -0.012717355042696, -0.013893269002437592, 0.03890562430024147, -0.045058514922857285, 0.03494955226778984, -0.024961888790130615, -0.037137843668460846, -0.037119925022125244, 0.0963384360074997, 0.15985006093978882, 0.13545027375221252, -0.04694269970059395, 0.015451638028025627, -0.02403596043586731, 0.09434840828180313, 0.18392854928970337, -0.04508744552731514, 0.07669774442911148, -0.047421980649232864, 0.28938034176826477, 0.20860476791858673, -0.048638246953487396, 0.0074852993711829185, 0.22018781304359436, 0.03073214180767536, 0.024952774867415428, 0.2402036190032959, 0.03368866816163063, 0.17659056186676025, 0.015061920508742332, -0.011221147142350674, -0.0013673037756234407, -0.02416372299194336, -0.0007474933518096805, 0.01712070219218731, -0.017609309405088425, 0.011895637959241867, 0.006496928632259369, 0.053432341665029526, 0.023569311946630478, 0.04078657925128937, -0.002033649943768978, 0.0012432851362973452, -0.2864089608192444, -0.042416539043188095, 0.015185205265879631, 0.07018797099590302, 0.0997282937169075, -0.07611632347106934, 0.0034618014469742775, 0.0005447324365377426, -0.0004859173786826432, -0.004036212805658579, 0.005797110497951508, -0.0008331718272529542, -0.00029083070694468915, 0.0017517565283924341, -0.001649307319894433, -0.01499999687075615, 0.0026460783556103706, 0.020254183560609818, -0.0007322850869968534, -0.0004979100776836276, -0.010097034275531769, 0.000551374803762883, 0.0006813728832639754, 0.0006420217687264085, -0.0022468881215900183, -0.0012773146154358983, 0.0008428756846114993, 0.0009928025538101792, -0.008638192899525166, -0.04576193541288376, -0.8094841837882996, 0.011935196816921234, -0.012397215701639652, 0.12650449573993683, -0.03409932926297188, -0.02081691287457943, -0.007645200937986374, 0.02143055573105812, -0.02598336897790432, -0.11437862366437912, -0.787918210029602, 0.014516817405819893, 0.046475570648908615, -0.13008181750774384, 0.18146224319934845, 0.3659980297088623, -0.32881587743759155, 0.18400996923446655, -0.3332679271697998, 0.0019567208364605904, 1.8609284162521362, 1.6541639566421509, 1.182018756866455, -0.0406152717769146, -0.20942865312099457, -0.044915031641721725, 0.042774517089128494, -0.36726146936416626, 1.3225126266479492, 0.878512978553772, 1.6996487379074097, -0.20829589664936066, 0.36236512660980225, 1.2490036487579346, 0.016055375337600708, -0.011784720234572887, 1.4576568603515625, -0.03906511887907982, 0.4587307274341583, 0.1599580943584442, -0.015006138011813164, 0.855299711227417, 0.7676370143890381, -0.07296902686357498, -0.04761255905032158, 0.01879403367638588, -0.015674952417612076, 0.027654029428958893, 0.11175596714019775, 0.5088574886322021, 0.6635278463363647, 0.7252123355865479, 0.010723286308348179, 0.5117210149765015, 1.176256775856018, -0.002315853489562869, -0.011747321113944054, 0.2667001485824585, 0.00222928449511528, 0.2548248767852783, 0.47604691982269287, 0.032514046877622604, -0.04815252125263214, -0.5691578984260559, -0.2854143977165222, -0.021012375131249428, -2.9068386554718018, -0.0037841200828552246, -0.020607883110642433, -3.335472583770752, -5.0627617835998535, -0.7152851223945618, -0.8359109163284302, -2.9759483337402344, -2.956233024597168, -0.20016904175281525, -0.01422118116170168, -0.04503164440393448, -6.158638000488281, -0.043731510639190674, -0.8756429553031921, -2.7471165657043457, -0.03737755864858627, 0.03030628338456154, -0.013976287096738815, -0.023257816210389137, -0.02199786901473999, 0.016414131969213486, -0.02549825981259346, 0.04698321595788002, 0.04613408073782921, -0.04104205220937729, -0.024277592077851295, 0.027166452258825302, -0.04010939598083496, -0.04458627849817276, -0.02392336167395115, 0.042018402367830276, -0.016861915588378906, -0.012293685227632523, -0.03742402791976929, -0.021543432027101517, 0.013768184930086136, -0.009748756885528564, -0.0035326252691447735, -0.00764115434139967, -0.004777729045599699, -0.034741587936878204, -0.048969049006700516, -0.02108612097799778, 0.008911296725273132, -0.021361861377954483, -0.003004670375958085, -0.031242715194821358, -0.026772385463118553, 0.0326835922896862, 0.012707466259598732, -0.014482002705335617, 0.010475636459887028, -0.034634459763765335, -0.021808572113513947, -0.013946404680609703, -0.0038875830359756947, -0.0423896349966526, -0.041803374886512756, -0.8407993912696838, -0.7914111018180847, -0.05241057276725769, -0.04744970053434372, -0.02105754055082798, -0.0358213409781456, 0.024843204766511917, -0.026013387367129326, 0.00839115958660841, -0.69028240442276, -0.9144204258918762, -0.034407611936330795, 0.0015517789870500565, 0.07473086565732956, 0.0008267515804618597, -0.019048143178224564, -0.02738654427230358, -0.037351056933403015, -0.37020978331565857, 0.028523555025458336, -0.044904112815856934, 2.744250774383545, 0.5809245109558105, 0.4695305824279785, -0.04603157564997673, -4.584885597229004, 0.03080788254737854, 0.024904560297727585, -4.919389247894287, -2.3149988651275635, 0.17725585401058197, 3.7448890209198, -4.168913841247559, -1.5871373414993286, 0.3261886239051819, 0.027385760098695755, -0.02136065810918808, 1.8561007976531982, 0.02938922867178917, 0.2932415008544922, -1.77591872215271, 0.03953882306814194, 0.8319331407546997, 0.6045930981636047, 0.2141634076833725, -0.011826048605144024, -0.0023878850042819977, -0.030341535806655884, -0.03601685166358948, 0.5138587951660156, 0.4788285493850708, 0.7947210073471069, 0.9499709606170654, 0.11879586428403854, 0.4073195159435272, 1.6830224990844727, 0.0045607383362948895, -0.003818234894424677, 0.400511771440506, -0.009139391593635082, 0.24429185688495636, 0.853255033493042, -0.02309948205947876, -0.027736926451325417, 0.039283718913793564, -0.017672814428806305, 0.009350262582302094, -0.031018078327178955, 0.04418567195534706, -0.012758374214172363, 0.001081179827451706, -0.0038542039692401886, -0.0460633747279644, -0.0347231850028038, 0.00442495197057724, -0.04139374569058418, -0.004716537892818451, 0.026833344250917435, -0.019949615001678467, -0.019079912453889847, 0.024292651563882828, -0.020990753546357155, 0.03671533986926079, 0.007956720888614655, 2.5677425861358643, 0.9140061736106873, 0.895862877368927, -0.00011977204121649265, -0.6324324607849121, -0.04476955905556679, -0.019070345908403397, 0.09918288886547089, -0.4248361587524414, 0.4579126834869385, 2.744924545288086, -0.24807852506637573, 1.0800563097000122, 0.828000009059906, 0.002009256510064006, -0.04256794601678848, 1.5237436294555664, -0.020223356783390045, 0.9370644092559814, 0.4433203339576721, 0.03488956764340401, -0.020848989486694336, -0.0012655481696128845, -0.04356282949447632, -0.0352482795715332, 0.020108509808778763, -0.002474389970302582, 0.031456757336854935, 0.025917459279298782, -0.03701234981417656, 0.0020193830132484436, -0.030391527339816093, -0.04885103926062584, -0.00034590810537338257, 0.0158812515437603, 0.022707495838403702, -0.029467403888702393, 0.025817979127168655, -0.03233383968472481, -0.007823418825864792, 0.040694061666727066, 0.017655471339821815, 0.4097626209259033, 0.4665347933769226, 0.12474595755338669, -0.017293255776166916, 0.1253785490989685, 0.020017525181174278, -0.029712924733757973, -0.14597554504871368, 0.48606958985328674, 0.5056288838386536, 0.25767451524734497, -0.08608264476060867, 0.2854503095149994, 1.2704501152038574, 0.01285010389983654, 0.02279568836092949, 0.15599173307418823, -0.005109080113470554, 0.45622360706329346, 0.7322306632995605, 0.0040467046201229095, 0.5810506343841553, 0.9523622989654541, -0.821450412273407, -0.009880165569484234, -0.21639518439769745, 0.0032723061740398407, 0.002741467673331499, -0.7833244204521179, -0.878528892993927, 1.298000454902649, -0.0941665917634964, 0.2085152268409729, -2.6721181869506836, -0.6086351871490479, -0.0005399221554398537, -0.0007126861601136625, -2.428455114364624, 0.02786952629685402, 0.567223846912384, -1.8317548036575317, -0.012088131159543991, 0.045986101031303406, -0.01925314962863922, -0.04254935309290886, 0.005516409873962402, 0.017409371212124825, -0.04625549539923668, -0.0061814673244953156, 0.01946382410824299, 0.01937769167125225, 0.004800085909664631, -0.019137931987643242, 0.04540562257170677, 0.00429319404065609, 0.035578854382038116, -0.010982908308506012, 0.04766659811139107, -0.023716330528259277, 0.023949552327394485, 0.03670043870806694, 0.024350453168153763, -0.04994618147611618, 0.40727150440216064, 0.5102453827857971, 1.348449468612671, -0.016318228095769882, 0.4753115773200989, -0.008112878538668156, 0.006866847164928913, 0.2529948949813843, 0.6556955575942993, 0.5006330013275146, 0.8826216459274292, 0.29438599944114685, 0.8504399061203003, 1.3839207887649536, -0.05643019080162048, 0.004326057620346546, 1.021251916885376, -0.023100530728697777, 0.7023642659187317, 1.1094197034835815, -0.011542089283466339, 0.382205605506897, 0.4942189157009125, 0.4365519881248474, 0.045098308473825455, 0.30440375208854675, -0.04318616911768913, -0.03879954665899277, 0.203302264213562, 0.3862789273262024, 0.5360055565834045, 0.39596277475357056, 0.23144853115081787, 0.413541704416275, 0.7259569764137268, -0.012484203092753887, 0.01121763326227665, 0.6348145604133606, -0.04939835146069527, 0.5656922459602356, -0.016376551240682602, -0.04675751551985741, -0.6755377650260925, -0.5988916754722595, -0.169213205575943, 0.03784486651420593, -0.014874209649860859, -0.03214125335216522, -0.02779316157102585, 0.053729575127363205, 0.029534082859754562, -0.5042142271995544, -0.8771114945411682, 0.04927214980125427, 0.021766990423202515, -0.0413287915289402, -0.0008876404608599842, -0.021938780322670937, -0.0033702878281474113, -0.009556053206324577, -0.31550222635269165, -0.01384579949080944, 0.03931662067770958, -0.880233883857727, -0.7063043117523193, -0.46515077352523804, -0.002534516854211688, 0.004118264652788639, -0.019685445353388786, -0.028505992144346237, 0.028404701501131058, -0.013073021546006203, -0.628428041934967, -1.10318124294281, -0.02889920026063919, -0.020672554150223732, -0.059945810586214066, 0.024543846026062965, -0.020382314920425415, 0.005887911655008793, -0.019712774083018303, -0.6284694075584412, 0.043089255690574646, -0.052346061915159225, 0.30259817838668823, 0.4108324348926544, 0.3343372046947479, -0.030437147244811058, 0.2884153723716736, -0.03873976320028305, -0.021497705951333046, 0.10071101784706116, 0.43421491980552673, 0.524897575378418, 0.46654021739959717, 0.2834649980068207, 0.3532971739768982, 0.9155309796333313, -0.03873900696635246, 0.015128310769796371, 0.5299244523048401, -0.01945481449365616, 0.39874163269996643, 0.26937177777290344, 0.02075762115418911, -0.6773410439491272, -0.5785880088806152, -0.05519314110279083, -0.01696036569774151, 0.007372804917395115, 0.02007129043340683, -0.03705829381942749, 0.07252547889947891, 0.027118321508169174, -0.44650009274482727, -0.8851303458213806, 0.06898070871829987, 0.021800098940730095, -0.06210024654865265, -0.03985465317964554, 0.002466941485181451, 0.07895512133836746, 0.008491811342537403, -0.22402366995811462, -0.09483135491609573, 0.020937297493219376, 0.21859467029571533, 0.2717101573944092, 0.6434049606323242, -0.020198101177811623, 0.2546316385269165, -0.043179403990507126, 0.014803027734160423, -0.0935484766960144, 0.14284522831439972, 0.44984567165374756, 0.44996199011802673, 0.2592235505580902, 0.7873088717460632, 0.5968843102455139, 0.02987467311322689, -0.038621459156274796, 0.40057173371315, -0.023666679859161377, 0.6184003949165344, -0.3343934714794159, -0.0044538602232933044, -0.031068511307239532, -0.04272240772843361, 1.2405487298965454, 1.271246075630188, 0.6705641150474548, 0.9135393500328064, 0.8431785702705383, 0.8825369477272034, 0.5630596280097961, 0.45819881558418274, 0.3567538559436798, -0.012370039708912373, -0.010938935913145542, 0.007563781924545765, -0.8512871861457825, -0.20588649809360504, 0.1043674498796463, 0.0015654392773285508, -0.0194280743598938, 0.02407924272119999, -0.03813621774315834, -0.01288849301636219, 0.051667969673871994, -0.19860999286174774, -0.1280483901500702, 0.14457005262374878, -0.46134498715400696, 0.1420169621706009, 0.027564723044633865, 0.7663925290107727, 0.7882495522499084, 0.8905303478240967, -0.24582280218601227, 0.6740210652351379, 1.905804991722107, -0.32820361852645874, -0.1897527128458023, 0.05080905929207802, -0.5994023680686951, -0.3166433870792389, -0.20684748888015747, 1.0941755771636963, 0.7560104727745056, 0.7556867599487305, 0.029978714883327484, -0.002761608688160777, -0.026020117104053497, 0.01064441166818142, -0.0066189696080982685, -0.028603287413716316, 0.21687272191047668, -0.38554736971855164, -0.7832934856414795, -0.008408074267208576, 0.007823670282959938, -0.026706242933869362, 0.6084808707237244, 0.5904194116592407, 0.4722175598144531, -1.087929129600525, -0.997033417224884, -0.935431182384491, 0.017653658986091614, 0.13380122184753418, 0.1319645643234253, 0.0, -0.01723211631178856, 0.09803427755832672, -0.02076149731874466, 0.055022865533828735, 0.0, -0.01890920102596283, 0.0, 0.19874927401542664, 0.14140063524246216, -0.0035085766576230526, -0.04708413407206535, 0.18507422506809235, 0.09547148644924164, -0.030191710218787193, 0.2084171622991562, 0.13310383260250092, 0.11795540153980255, -0.005558319855481386, -0.21309219300746918, -0.12112467736005783, 0.13021694123744965, -0.0033662787172943354, 0.06446773558855057, -0.00306488829664886, -0.0043967668898403645, 0.04093175381422043, 0.08783431351184845, -0.05672932788729668, -0.2457118034362793, 0.08296872675418854, 0.06519559025764465, 0.06675814837217331, -0.0078548863530159, -0.02636110782623291, 0.0850498378276825, -0.0023269844241440296, 0.08662446588277817, 0.018035462126135826, 0.19426970183849335, 0.11425043642520905, 0.08655263483524323];
    let get_value = |i:i32| {values(i)};

    let eval_test = neural_eval(make_vec3(0,1,0), make_vec3(0,1,0), get_value);
    if (!eq_vec3(eval_test, make_vec3(6.530929,4.0269094,3.5987263))) {err += 1;}

    let eval_test2 = neural_eval(make_vec3(0.707,0.707,0), make_vec3(0.707,0.707,0), get_value);
    if (!eq_vec3(eval_test2, make_vec3(0.04094279, 0.03061962, 0.02384186))) {err += 1;}
    
    err
}

 fn test_neural() -> i32 {
    let mut err = 0;

    err += test_simple_propagate();
    err += test_eval();

    err
 }